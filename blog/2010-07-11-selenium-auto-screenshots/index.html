<!doctype html><html class="no-js" lang="ru"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title> Selenium+TestNG: Автоматическое снятие скриншотов при неуспешном прохождении теста</title><link rel="stylesheet" type="text/css" href="https://webdriver.ru/assets/css/styles_feeling_responsive.css" /> <script src="https://webdriver.ru/assets/js/modernizr.min.js"></script> <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script> <script> WebFont.load({ google: { families: [ 'Source Code Pro', 'Arimo::cyrillic', 'Philosopher::cyrillic' ] } }); </script> <noscript><link rel="preload" href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Arimo|Philosopher' rel='stylesheet' type='text/css' /> </noscript><meta name="description" content="Слушатели тренинга &quot;Программирование для тестировщиков&quot; часто задают вопросы, на которые я не успеваю ответить ни во время занятий, ни во время консультаций, и которые я рассматриваю как второстепенные, потому что они относятся не к к умению автоматизировать тесты, а к хитрым способам использования того или иного конкретного инструмента. Но поскольку вопросы действительно интересные, и поскольку иногда я знаю ответы на них, было бы несправедливо об этом умолчать, поэтому я решил оформить их в виде серии заметок. Как я уже сказал, вдохновение я черпаю из вопросов участников упомянутого выше тренинга, поэтому нетрудно догадаться, что заметки будут посвящены главным образом инструментам Selenium и TestNG. Это будет не систематическое изложение того, как делать тесты, и не документация по использованию инструментов, а небольшие рассказы о некоторых полезных приемах и штучках. В первой заметке я отвечу на, наверное, самый часто задаваемый вопрос: как сделать, чтобы при неуспешном прохождении теста автоматически снимался скриншот и добавлялся в отчет о результатах выполнения тестов. В одной из последующих заметок я расскажу о том, какие можно использовать разные способы снятия скриншотов, здесь же мы не будем этому уделять особого внимания, реализуем самый простой способ – снятие скриншота всего экрана." /><link rel="icon" sizes="32x32" href="https://webdriver.ru/assets/img/favicon-32x32.png" /><link rel="icon" sizes="192x192" href="https://webdriver.ru/assets/img/touch-icon-192x192.png" /><link rel="apple-touch-icon-precomposed" sizes="180x180" href="https://webdriver.ru/assets/img/apple-touch-icon-180x180-precomposed.png" /><link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://webdriver.ru/assets/img/apple-touch-icon-152x152-precomposed.png" /><link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://webdriver.ru/assets/img/apple-touch-icon-144x144-precomposed.png" /><link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://webdriver.ru/assets/img/apple-touch-icon-120x120-precomposed.png" /><link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://webdriver.ru/assets/img/apple-touch-icon-114x114-precomposed.png" /><link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://webdriver.ru/assets/img/apple-touch-icon-76x76-precomposed.png" /><link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://webdriver.ru/assets/img/apple-touch-icon-72x72-precomposed.png" /><link rel="apple-touch-icon-precomposed" href="https://webdriver.ru/assets/img/apple-touch-icon-precomposed.png" /><meta name="msapplication-TileImage" content="https://webdriver.ru/assets/img/msapplication_tileimage.png" /><meta name="msapplication-TileColor" content="#fabb00" /><meta property="og:locale" content="en_EN" /><meta property="og:title" content="Selenium+TestNG: Автоматическое снятие скриншотов при неуспешном прохождении теста" /><meta property="og:description" content="Слушатели тренинга &quot;Программирование для тестировщиков&quot; часто задают вопросы, на которые я не успеваю ответить ни во время занятий, ни во время консультаций, и которые я рассматриваю как второстепенные, потому что они относятся не к к умению автоматизировать тесты, а к хитрым способам использования того или иного конкретного инструмента. Но поскольку вопросы действительно интересные, и поскольку иногда я знаю ответы на них, было бы несправедливо об этом умолчать, поэтому я решил оформить их в виде серии заметок. Как я уже сказал, вдохновение я черпаю из вопросов участников упомянутого выше тренинга, поэтому нетрудно догадаться, что заметки будут посвящены главным образом инструментам Selenium и TestNG. Это будет не систематическое изложение того, как делать тесты, и не документация по использованию инструментов, а небольшие рассказы о некоторых полезных приемах и штучках. В первой заметке я отвечу на, наверное, самый часто задаваемый вопрос: как сделать, чтобы при неуспешном прохождении теста автоматически снимался скриншот и добавлялся в отчет о результатах выполнения тестов. В одной из последующих заметок я расскажу о том, какие можно использовать разные способы снятия скриншотов, здесь же мы не будем этому уделять особого внимания, реализуем самый простой способ – снятие скриншота всего экрана."/><meta property="og:url" content="https://webdriver.ru//blog/2010-07-11-selenium-auto-screenshots/" /><meta property="og:site_name" content="Selenium WebDriver: автоматизация веб-приложений" /><link type="text/plain" rel="author" href="https://webdriver.ru/humans.txt" /><body id="top-of-page" class="post"><div id="page"><div id="masthead-no-image-header"><div class="row"><div class="small-12 columns"> <a id="logo" href="https://webdriver.ru" title="Selenium WebDriver: автоматизация веб-приложений"> <img src="https://webdriver.ru/assets/img/logo.png" alt="Selenium WebDriver: автоматизация веб-приложений – "><h1>Selenium WebDriver</h1><h2>автоматизация веб-приложений</h2></a></div></div></div><div id="navigation" class="sticky"><nav class="top-bar" role="navigation" data-topbar><ul class="title-area"><li class="name"><h1 class="show-for-small-only"><a href="https://webdriver.ru" class="icon-tree"> Selenium WebDriver</a></h1><li class="toggle-topbar menu-icon"><a href="#"><span>Меню</span></a></ul><section class="top-bar-section"><ul class="right"><li class="divider"><li><a href="https://webdriver.ru/search/">Поиск</a></ul><ul class="left"><li link-url="/" page-url="/blog/2010-07-11-selenium-auto-screenshots/" ><a href="https://webdriver.ru/">Старт</a><li class="divider"><li link-url="/news/" page-url="/blog/2010-07-11-selenium-auto-screenshots/" ><a href="https://webdriver.ru/news/">Новости</a><li class="divider"><li link-url="/blog/" page-url="/blog/2010-07-11-selenium-auto-screenshots/" class="active"><a href="https://webdriver.ru/blog/">Блог</a><li class="divider"><li link-url="/trainings/" page-url="/blog/2010-07-11-selenium-auto-screenshots/" ><a href="https://webdriver.ru/trainings/">Обучение</a><li class="divider"><li link-url="http://software-testing.ru/forum/index.php?/forum/129-selenium-functional-testing/" page-url="/blog/2010-07-11-selenium-auto-screenshots/" ><a href="http://software-testing.ru/forum/index.php?/forum/129-selenium-functional-testing/" target="_blank">Форум</a><li class="divider"></ul></section></nav><div id="breadcrumb"><div class="row"><nav class="breadcrumbs bootstrap hidden-sm-down"> <a property="item" typeof="WebPage" href="/index.html"> <span class="icon-home" property="name"></span><meta property="position" content="1" /> </a> <a property="item" typeof="WebPage" href="/blog/index.html"> <span property="name">Блог</span><meta property="position" content="2" /> </a> <span property="name">Selenium+TestNG: Автоматическое снятие скриншотов при неуспешном прохождении теста</span><meta property="position" content="3" /></nav></div></div></div><div class="row t30"><div class="medium-8 columns"><article itemscope itemtype="http://schema.org/Article"><header> <span itemprop="name"><div class="date"><time class="icon-calendar pr20" datetime="2010-07-11" itemprop="datePublished"> 11 июля 2010 </time></div><h1>Selenium+TestNG: Автоматическое снятие скриншотов при неуспешном прохождении теста</h1></span></header><span itemprop="articleSection"><p>Слушатели тренинга <a href="https://software-testing.ru/edu/schedule/1">Программирование для тестировщиков</a> часто задают вопросы, на которые я не успеваю ответить ни во время занятий, ни во время консультаций, и которые я рассматриваю как второстепенные, потому что они относятся не к к умению автоматизировать тесты, а к хитрым способам использования того или иного конкретного инструмента.<p>Но поскольку вопросы действительно интересные, и поскольку иногда я знаю ответы на них, было бы несправедливо об этом умолчать, поэтому я решил оформить их в виде серии заметок. Как я уже сказал, вдохновение я черпаю из вопросов участников упомянутого выше тренинга, поэтому нетрудно догадаться, что заметки будут посвящены главным образом инструментам Selenium и TestNG. Это будет не систематическое изложение того, как делать тесты, и не документация по использованию инструментов, а небольшие рассказы о некоторых полезных приемах и штучках.<p>В первой заметке я отвечу на, наверное, самый часто задаваемый вопрос: как сделать, чтобы при неуспешном прохождении теста автоматически снимался скриншот и добавлялся в отчет о результатах выполнения тестов. В одной из последующих заметок я расскажу о том, какие можно использовать разные способы снятия скриншотов, здесь же мы не будем этому уделять особого внимания, реализуем самый простой способ – снятие скриншота всего экрана.<h2 id="оригинальная-версия-selenesetestnghelper">Оригинальная версия <code class="highlighter-rouge">SeleneseTestNgHelper</code></h2><p>Если вы когда-нибудь в Selenium IDE указывали “Java (TestNG)” в качестве целевого формата для генерации кода, вы могли видеть заготовку теста приблизительно такого вида:<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">tests</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.thoughtworks.selenium.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">testng</span><span class="o">.</span><span class="na">Assert</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">java.util.regex.Pattern</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Untitled</span> <span class="kd">extends</span> <span class="n">SeleneseTestNgHelper</span> <span class="o">{</span>
<span class="err"> </span> <span class="nd">@Test</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testUntitled</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
<span class="err"> </span> <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Но если вы попробуете перенести этот код в среду разработки и скомпилировать его, вас постигнет разочарование – класса <code class="highlighter-rouge">SeleneseTestNgHelper</code> нет ни в Selenium RC, ни в TestNG. На официальных сайтах Selenium и TestNG он тоже не упоминается и загрузить его оттуда нельзя.<p>Тем не менее, при желании этот класс <a href="http://grepcode.com/snapshot/repo1.maven.org/maven2/org.seleniumhq.selenium.client-drivers/selenium-java-testng-helper/1.0.1/">можно найти</a>, как в уже скомпилированном виде, так и в исходном коде. Чтобы использовать его, достаточно помимо Selenium RC подключить ещё дополнительную библиотеку <a href="http://repo1.maven.org/maven2/org/seleniumhq/selenium/client-drivers/selenium-java-testng-helper/1.0.1/selenium-java-testng-helper-1.0.1.jar">selenium-java-testng-helper-1.0.1.jar</a>.<p>А, собственно, причём тут этот класс? Ведь я обещал рассказать про автоматическое снятие скриншотов при неуспешном прохождении теста? Всё верно, дело в том, что <code class="highlighter-rouge">SeleneseTestNgHelper</code> как раз и содержит реализацию этой функциональности! Просто добавьте вышеуказанную библиотеку в ваш проект, унаследуйте тесты от класса <code class="highlighter-rouge">SeleneseTestNgHelper</code> – и всё.<p>Впрочем, нет, не всё.<h2 id="улучшенная-версия-selenesetestnghelper">Улучшенная версия SeleneseTestNgHelper</h2><p>Когда я сам начал пользоваться этим расширением, я обнаружил несколько неприятных особенностей, результатом борьбы с которыми явилась существенная его переделка, которую я и хочу предложить вам как альтернативу оригинальному SeleneseTestNgHelper (ссылки на скачивание – в конце статьи).<p>Далее – описание того, чем мой вариант <code class="highlighter-rouge">SeleneseTestNgHelper</code> отличается (в лучшую сторону, конечно :) ) от того, ссылка на который приведена выше.<p><strong>1. Оригинальное расширение использует для снятия скриншотов второй экземпляр Selenium, а не тот, который управляет тестируемым приложением.</strong> И вовсе не потому, что так лучше, а потому, что когда разрабатывался <code class="highlighter-rouge">SeleneseTestNgHelper</code>, не существовало честного способа переиспользовать тот же самый экземпляр Selenium.<p>Такая возможность появилась лишь относительно недавно с появлением в TestNG нового интерфейса <code class="highlighter-rouge">IInvokedMethodListener2</code> (он пока ещё не описан в официальной документации, но можно найти его описание в <a href="http://testng.org/javadocs/org/testng/IInvokedMethodListener2.html">javadoc</a>.<p>Соответственно, я переписал <code class="highlighter-rouge">ScreenshotListener</code> так, чтобы он реализовывал именно этот новый интерфейс и использовал для снятия скриншотов тот же самый экземпляр Selenium.<p>Чем это лучше? Во-первых, это позволяет вывести на передний план и развернуть окно браузера перед снятием скриншота, вызвав методы <code class="highlighter-rouge">selenium.windowFocus()</code> и <code class="highlighter-rouge">selenium.windowMaximize()</code>. Во-вторых, это даёт возможность использовать способ снятия скриншота не со всего экрана, а со страницы приложения, включая невидимые части, требующие скроллирования (впрочем, об этом, как я и обещал, расскажу в другой заметке).<p><strong>2. Оригинальное расширение содержит жестко прописанный в коде механизм подключения ScreenshotListener.</strong> Более правильным способом является использование внешних методов подключения “слушателей” (listeners) – в командной строке, конфигурационном файле или в аннотации @Listeners.<p>Поэтому я удалил абсолютно ненужный метод <code class="highlighter-rouge">attachScreenshotListener</code>, а для обратной совместимости добавил классу <code class="highlighter-rouge">SeleneseTestNgHelper</code> аннотацию <code class="highlighter-rouge">@Listeners({ScreenshotListener.class})</code>. В результате автоматическое снятие скриншотов будет включено у всех тестов, которые наследуются от класса <code class="highlighter-rouge">SeleneseTestNgHelper</code>.<p>Кстати, такая замена жестко закодированного подключения на аннотацию тоже стала возможна лишь после того, как совсем недавно в TestNG стало возможно указывать аннотацию <code class="highlighter-rouge">@Listeners</code> у базового класса, раньше это нужно было делать у каждого тестового класса отдельно (либо использовать конфигурационный файл).<p>Конечно, эту аннотацию в классе <code class="highlighter-rouge">SeleneseTestNgHelper</code> тоже можно считать жестко закодированной. Но ещё раз подчёркиваю – она там оставлена для обеспечения обратной совместимости с предыдущей версией. А если вы хотите включать слушатель <code class="highlighter-rouge">ScreenshotListener</code> только для отдельных тестов, либо включать разные слушатели для разных тестов, тогда вам нужно в исходном коде класса <code class="highlighter-rouge">SeleneseTestNgHelper</code> удалить аннотацию <code class="highlighter-rouge">@Listeners</code> и сделать свои собственные настройки. Я не стал делать отдельную скомпилированную версию с отключенным слушателем, желающие обеспечить большую гибкость могут взять исходный код и доработать его самостоятельно.<p>Напоследок следует отметить, что сейчас в рамках Selenium 2.0 разрабатывается новая версия <code class="highlighter-rouge">SeleneseTestNgHelper</code>, оптимизированная для использования с новым движком WebDriver, а данная версия предлагается всем тем, кто использует сейчас и собирается продолжать использовать Selenium 1.x.<p>Скомпилированная библиотека: <a href="http://software-testing.ru/files/library/barancev/selenium_screenshoots/selenium-java-testng-helper-1.1.jar">selenium-java-testng-helper-1.1.jar</a>, проект Eclipse, содержащий исходный код: <a href="http://software-testing.ru/files/library/barancev/selenium_screenshoots/SeleniumScreenshoots.zip">SeleniumScreenshoots.zip</a> </span><div id="page-meta" class="t30"><p> <time class="icon-calendar pr20" datetime="2010-07-11" itemprop="datePublished"> 11 июля 2010 </time> <span class="icon-archive pr20">&nbsp;<a href="https://webdriver.ru/blog/">БЛОГ</a></span> <br /> <span class="pr20"></span><ul class="pager"><li>&nbsp;|&nbsp;<li><a href="https://webdriver.ru/blog/2010-08-05-selenium-remote-screenshots/">Selenium: Снятие скриншотов на удаленной машине &rarr;</a></ul></div></article></div><div class="medium-4 columns"><aside><div class="panel radius"><h3>Новые публикации</h3><ul class="side-nav"><li><a href="https://webdriver.ru/news/2019-11-25-seleniumconf-london/">Опубликованы материалы конференции SeleniumConf London 2019</a><li><a href="https://webdriver.ru/news/2019-11-18-selenium-dev/">Запущен новый сайт selenium.dev</a><li><a href="https://webdriver.ru/news/2018-07-10-selenium-314/">Вышел релиз Selenium 3.14</a><li><a href="https://webdriver.ru/news/2018-07-10-selenium-313/">Вышел релиз Selenium 3.13</a><li><a href="https://webdriver.ru/news/2018-06-25-selenium-312/">Вышел релиз Selenium 3.12</a></ul></div><div class="panel radius"><h3>Ближайшие тренинги</h3><ul class="side-nav"><li> <span class="course-title"><a href="http://software-testing.ru/edu/3-online/242-selenium-webdriver"><time class="icon-calendar date"> 18 июня 2021</time><br>Selenium WebDriver: полное руководство</a></span><li> <span class="course-title"><a href="http://software-testing.ru/edu/3-online/226-csharp-for-testers"><time class="icon-calendar date"> 25 июня 2021</time><br>Программирование на C# для тестировщиков</a></span><li> <span class="course-title"><a href="http://software-testing.ru/edu/3-online/19-performance-testing-jmeter"><time class="icon-calendar date"> 2 июля 2021</time><br>Тестирование производительности: JMeter 5</a></span><li> <span class="course-title"><a href="http://software-testing.ru/edu/3-online/185-selenium"><time class="icon-calendar date"> 9 июля 2021</time><br>Selenium IDE 3: стартовый уровень</a></span><li> <span class="course-title"><a href="http://software-testing.ru/edu/3-online/1-java-for-testers"><time class="icon-calendar date"> 9 июля 2021</time><br>Программирование на Java для тестировщиков</a></span><li> <span class="course-title"><a href="http://software-testing.ru/edu/3-online/46-test-design"><time class="icon-calendar date"> 16 июля 2021</time><br>Практикум по тест-дизайну 2.0</a></span><li> <span class="course-title"><a href="http://software-testing.ru/edu/3-online/189-web"><time class="icon-calendar date"> 16 июля 2021</time><br>Тестирование веб-приложений 2.0</a></span><li> <span class="course-title"><a href="http://software-testing.ru/edu/3-online/234-functional-test-automation"><time class="icon-calendar date"> 23 июля 2021</time><br>Автоматизация функционального тестирования</a></span><li> <span class="course-title"><a href="http://software-testing.ru/edu/3-online/233-python"><time class="icon-calendar date"> 23 июля 2021</time><br>Программирование на Python для тестировщиков</a></span></ul></div></aside></div></div><footer id="footer-content" class="bg-grau"><div id="footer"><div class="row"><div class="medium-6 large-5 columns"><h5 class="shadow-black">О нас</h5><ul class="no-bullet shadow-black"><li><a href="https://webdriver.ru/info/">Пишем про Selenium на русском языке</a></ul></div><div class="small-6 medium-3 large-3 large-offset-1 columns"><h5 class="shadow-black">RSS/Atom</h5><ul class="no-bullet shadow-black"><li > <a href="" title=""></a><li > <a href="/feed.xml" title="Subscribe to RSS Feed">RSS</a><li > <a href="/atom.xml" title="Subscribe to Atom Feed">Atom</a></ul></div><div class="small-6 medium-3 large-3 columns"><h5 class="shadow-black">Благодарности</h5><ul class="no-bullet shadow-black"><li > <a href="" title=""></a><li class="services-newsletter" > <a href="https://jekyllrb.com/" target="_blank" title="Built with Jekyll">Built with Jekyll</a><li class="services-newsletter" > <a href="https://github.com/Phlow/feeling-responsive" target="_blank" title="Design by Phlow">Design by Phlow</a><li class="services-newsletter" > <a href="http://foundation.zurb.com/" target="_blank" title="Built on Foundation">Built on Foundation</a></ul></div></div></div><div id="subfooter"><nav class="row"><section id="subfooter-left" class="b30 small-12 medium-6 columns credits"></section><section id="subfooter-right" class="small-12 medium-6 columns social-icons"><ul class="inline-list"></ul></section></nav></div></footer><script src="https://webdriver.ru/assets/js/javascript.min.js"></script></div>
