<!doctype html><html class="no-js" lang="ru"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title> Selenium: Снятие скриншотов веб-страницы целиком</title><link rel="stylesheet" type="text/css" href="https://webdriver.ru/assets/css/styles_feeling_responsive.css" /> <script src="https://webdriver.ru/assets/js/modernizr.min.js"></script> <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script> <script> WebFont.load({ google: { families: [ 'Source Code Pro', 'Arimo::cyrillic', 'Philosopher::cyrillic' ] } }); </script> <noscript><link rel="preload" href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Arimo|Philosopher' rel='stylesheet' type='text/css' /> </noscript><meta name="description" content="Эта статья завершает серию, посвящённую снятию скриншотов при выполнении автотестов, разработанных с использованием Selenium и TestNG" /><link rel="icon" sizes="32x32" href="https://webdriver.ru/assets/img/favicon-32x32.png" /><link rel="icon" sizes="192x192" href="https://webdriver.ru/assets/img/touch-icon-192x192.png" /><link rel="apple-touch-icon-precomposed" sizes="180x180" href="https://webdriver.ru/assets/img/apple-touch-icon-180x180-precomposed.png" /><link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://webdriver.ru/assets/img/apple-touch-icon-152x152-precomposed.png" /><link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://webdriver.ru/assets/img/apple-touch-icon-144x144-precomposed.png" /><link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://webdriver.ru/assets/img/apple-touch-icon-120x120-precomposed.png" /><link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://webdriver.ru/assets/img/apple-touch-icon-114x114-precomposed.png" /><link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://webdriver.ru/assets/img/apple-touch-icon-76x76-precomposed.png" /><link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://webdriver.ru/assets/img/apple-touch-icon-72x72-precomposed.png" /><link rel="apple-touch-icon-precomposed" href="https://webdriver.ru/assets/img/apple-touch-icon-precomposed.png" /><meta name="msapplication-TileImage" content="https://webdriver.ru/assets/img/msapplication_tileimage.png" /><meta name="msapplication-TileColor" content="#fabb00" /><meta property="og:locale" content="en_EN" /><meta property="og:title" content="Selenium: Снятие скриншотов веб-страницы целиком" /><meta property="og:description" content="Эта статья завершает серию, посвящённую снятию скриншотов при выполнении автотестов, разработанных с использованием Selenium и TestNG"/><meta property="og:url" content="https://webdriver.ru//blog/2011-01-11-selenium-pageshots/" /><meta property="og:site_name" content="Selenium WebDriver: автоматизация веб-приложений" /><link type="text/plain" rel="author" href="https://webdriver.ru/humans.txt" /><body id="top-of-page" class="post"><div id="page"><div id="masthead-no-image-header"><div class="row"><div class="small-12 columns"> <a id="logo" href="https://webdriver.ru" title="Selenium WebDriver: автоматизация веб-приложений"> <img src="https://webdriver.ru/assets/img/logo.png" alt="Selenium WebDriver: автоматизация веб-приложений – "><h1>Selenium WebDriver</h1><h2>автоматизация веб-приложений</h2></a></div></div></div><div id="navigation" class="sticky"><nav class="top-bar" role="navigation" data-topbar><ul class="title-area"><li class="name"><h1 class="show-for-small-only"><a href="https://webdriver.ru" class="icon-tree"> Selenium WebDriver</a></h1><li class="toggle-topbar menu-icon"><a href="#"><span>Меню</span></a></ul><section class="top-bar-section"><ul class="right"><li class="divider"><li><a href="https://webdriver.ru/search/">Поиск</a></ul><ul class="left"><li link-url="/" page-url="/blog/2011-01-11-selenium-pageshots/" ><a href="https://webdriver.ru/">Старт</a><li class="divider"><li link-url="/news/" page-url="/blog/2011-01-11-selenium-pageshots/" ><a href="https://webdriver.ru/news/">Новости</a><li class="divider"><li link-url="/blog/" page-url="/blog/2011-01-11-selenium-pageshots/" class="active"><a href="https://webdriver.ru/blog/">Блог</a><li class="divider"><li link-url="/trainings/" page-url="/blog/2011-01-11-selenium-pageshots/" ><a href="https://webdriver.ru/trainings/">Обучение</a><li class="divider"><li link-url="http://software-testing.ru/forum/index.php?/forum/129-selenium-functional-testing/" page-url="/blog/2011-01-11-selenium-pageshots/" ><a href="http://software-testing.ru/forum/index.php?/forum/129-selenium-functional-testing/" target="_blank">Форум</a><li class="divider"></ul></section></nav><div id="breadcrumb"><div class="row"><nav class="breadcrumbs bootstrap hidden-sm-down"> <a property="item" typeof="WebPage" href="/index.html"> <span class="icon-home" property="name"></span><meta property="position" content="1" /> </a> <a property="item" typeof="WebPage" href="/blog/index.html"> <span property="name">Блог</span><meta property="position" content="2" /> </a> <span property="name">Selenium: Снятие скриншотов веб-страницы целиком</span><meta property="position" content="3" /></nav></div></div></div><div class="row t30"><div class="medium-8 columns"><article itemscope itemtype="http://schema.org/Article"><header> <span itemprop="name"><div class="date"><time class="icon-calendar pr20" datetime="2011-01-11" itemprop="datePublished"> 11 января 2011 </time></div><h1>Selenium: Снятие скриншотов веб-страницы целиком</h1></span></header><span itemprop="articleSection"><p>Эта статья завершает серию, посвящённую снятию скриншотов при выполнении автотестов, разработанных с использованием Selenium и TestNG.<p>Предыдущие статьи:<ul><li><a href="/articles/10-selenium-auto-screenshots">Selenium+TestNG: Автоматическое снятие скриншотов при неуспешном прохождении теста</a><li><a href="/articles/9-selenium-remote-screenshots">Selenium: Снятие скриншотов на удаленной машине</a></ul><p>Здесь речь пойдёт о снятии скриншотов страницы целиком – не только видимой её части, но и тех частей, которые можно увидеть лишь проскроллировав окно браузера. Я расскажу про два способа снятия таких “пейджшотов”:<ul><li>средствами только Selenium;<li>при помощи AutoIt и какой-нибудь внешней утилиты снятия скриншотов, умеющей автоматически скроллировать окна.</ul><p>Первый способ работает как при локальном, так и при удалённом запуске тестов, но поддерживаются только браузеры Internet Explorer и FireFox. Второй способ пригоден только при локальном запуске тестов, а поддержка браузеров определяется возможностями используемой внешней утилиты-скриншотера.<p>В качестве основы будем использовать уже описанный в предыдущих статьях класс <code class="highlighter-rouge">TestNgHelper</code>. Мы добавим к нему метод для подключения скриншотера, реализуем два вышеописанных механизма снятия скриншотов, а затем, как и ранее, подключим их при помощи специального листенера, чтобы скриншоты автоматически снимались при неуспешном завершении теста.<p>Всё нижеописанное в виде исходного кода на языке Java вы сможете найти в приложенном файле, ссылка на который находится в конце статьи.<h2 id="конфигурирование-скриншотера">Конфигурирование скриншотера</h2><p>Если вы пользуетесь связкой TestNG + Selenium, вы наверняка знаете, что TestNG позволяет задавать параметры в конфигурационном файле, где описываются тестовые наборы (этот файл обычно называется <code class="highlighter-rouge">testng.xml</code>). Однако я не очень люблю этот способ (причины этой нелюбви оставим пока в стороне, про это будет отдельная статья), поэтому в файле <code class="highlighter-rouge">testng.xml</code> я предпочитаю делать ссылку на отдельный конфигурационный файл, в котором уже описываются все параметры.<p>Именно так мы мы поступим и в этом случае. В файле testng.xml будет добавлена вот такая ссылка:<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">"screenshoter.properties"</span> <span class="na">value=</span><span class="s">"/screenshoter.properties"</span> <span class="nt">/&gt;</span></code></pre></figure><p>Обратите внимание на то, что ссылка начинается со слеша, это ссылка на Java-ресурс, её поиск будет производиться во всех директориях и файлах, которые включены в CLASSPATH.<p>А вот что находится в файле <code class="highlighter-rouge">screenshoter.properties</code>:<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="py">mode</span> <span class="p">=</span> <span class="s">autoit</span>

<span class="py">selenium.entirePage</span> <span class="p">=</span> <span class="s">true</span>
<span class="py">selenium.background</span> <span class="p">=</span> <span class="s">white</span>

<span class="py">autoit.path</span> <span class="p">=</span> <span class="s">C:/Program Files/AutoIt3/AutoIt3.exe</span>
<span class="py">autoit.script</span> <span class="p">=</span> <span class="s">take_screenshot.au3</span></code></pre></figure><p>Первая строчка – указание механизма снятия скриншотов: либо средствами Selenium, либо при помощи AutoIt. А далее настраиваются параметры для каждого из механизмов. Назначение параметров, надеюсь, интуитивно понятно из их названия, но тем не менее, про них будет чуть подробнее написано ниже в соответствующих разделах.<p>В классе <code class="highlighter-rouge">TestNgHelper</code>, который находится в приложенном к этой статье файле, есть два интересных метода – <code class="highlighter-rouge">configureScreenshoter</code>, который инициализирует скриншотер: в зависимости от значения параметра mode создаётся либо <code class="highlighter-rouge">SeleniumScreenshoter</code>, либо <code class="highlighter-rouge">AutoItScreenshoter</code>, а затем этот скриншотер в методе <code class="highlighter-rouge">setTestContext</code> помещается в тестовый контекст, откуда он может быть извлечён любым тестом или листенером.<p>Да-да, скриншоты можно снимать и непосредственно в тестах, там, где вам это потребовалось, но про это я расскажу в отдельной статье, посвящённой <a href="http://testng.org/doc/documentation-main.html#dependency-injection">инъекциям в TestNG</a>.<p>Следует отметить, что теперь для автоматического снятия скриншотов при неуспешном завершении тестов нам достаточно иметь один единственный универсальный листенер ScreenshotListener, который будет использовать ранее сконфигурированный скриншотер, находящийся в тестовом контексте. Многочисленные реализации листенеров, которые я описывал во второй статье этой серии, были “расклонированы” исключительно для удобства объяснения.<p>Подключить этот листенер можно одним из трёх способов:<ul><li>добавив тестовому классу аннотацию <code class="highlighter-rouge">@Listeners({ScreenshotListener.class})</code><li>добавив в файл testng.xml инструкцию <code class="highlighter-rouge">&lt;listeners&gt;&lt;listener class-name="ru.st.selenium.ScreenshotListener"&gt;&lt;/listener&gt;&lt;/listeners&gt;</code><li>указав при запуске TestNG опцию <code class="highlighter-rouge">-listener ru.st.selenium.ScreenshotListener</code></ul><p>А теперь, когда я рассказал, как этим пользоваться, пришло время объяснить, когда оно работает, а когда нет.<h2 id="снятие-скриншотов-средствами-selenium">Снятие скриншотов средствами Selenium</h2><p>Класс <code class="highlighter-rouge">SeleniumScreenshoter</code> реализует наиболее универсальный способ снятия скриншотов средствами Selenium – он использует методы <code class="highlighter-rouge">captureScreenshotAsString</code> либо <code class="highlighter-rouge">captureEntirePageScreenshotToString</code> в зависимости от значения параметра <code class="highlighter-rouge">selenium.entirePage</code>. Если значение этого параметра установлено в false, делается снимок экрана, а если параметр имеет значение true, тогда Selenium делает попытку снять “пейджшот”, то есть получить изображение всей веб-страницы целиком, включая невидимые области, скрытые за границами окна браузера.<p>Этот способ не требует никаких дополнительных инструментов и утилит, работает как при локальном, так и при удалённом выполнении тестов. Казалось бы чего ещё желать. Однако не обошлось без большущей ложки дёгтя – снятие “пейджшотов” работает только в FireFox в режимах <code class="highlighter-rouge">*firefox</code> и <code class="highlighter-rouge">*chrome</code> и в Internet Explorer в режиме <code class="highlighter-rouge">*iexploreproxy</code> (а в IE9 мне не удалось заставить его работать даже в этом режиме). Иными словами, как раз в тех браузерах, где чаще всего сбоят тесты, мы и не имеем возможности снимать “пейджшоты”, приходится ограничиваться лишь видимой частью страницы.<p>Однако на свете существует великое множество инструментов для снятия скриншотов, которые либо поддерживают автоскроллирование, либо имеют функцию расширения окна за пределы экрана. И то и другое даёт возможность снимать “пейджшоты”. Но как прикрутить это к Selenium и TestNG? И вот тут приходит на помощь AutoIt и <code class="highlighter-rouge">AutoItScreenshoter</code>.<h2 id="снятие-пейджшотов-внешним-инструментом">Снятие “пейджшотов” внешним инструментом</h2><p>Чтобы использовать внешний инструмент для автоматического снятия скриншотов, надо его предварительно должным образом настроить, а также подготовить небольшой скрипт для инструмента AutoIt, который принимает на вход два параметра: 1) название окна браузера и 2) путь к файлу, в который необходимо сохранить снятый скриншот. Ссылку на этот скрипт следует прописать в конфигурационном файле в качестве значения параметра <code class="highlighter-rouge">autoit.script</code>, а также надо указать <code class="highlighter-rouge">mode = autoit</code>.<p>В приложенном файле (ищите в конце статьи) имеется достаточно универсальный скрипт <code class="highlighter-rouge">take_screenshot.au3</code>, который предполагает, что внешний скриншотер:<ul><li>запускается по горячей клавише <code class="highlighter-rouge">Ctrl-Alt-PrintScreen</code>,<li>ожидает, пока пользователь кликнет в окно, с которого нужно снять скриншот,<li>делает снимок в соответствии с предварительно сделанными настройками,<li>выводит диалоговое окно для сохранения скриншота.</ul><p>Я использовал этот скрипт без каких-либо изменений с самыми различными скриншотерами – SnagIt, HyperSnap, PicPick. Почему мне потребовались разные утилиты? Потому что они тоже не все одинаково хорошо работают с различными браузерами. Но об этом я расскажу как-нибудь в другой раз.<p>Разумеется, этот способ работает только при локальном запуске тестов. Но зато теперь мы имеем возможность выбирать из огромного числа инструментов снятия скриншотов, так что наверняка найдётся подходящий даже для самого капризного браузера.<p>Ах да, ну и конечно нужно ещё не забыть установить <a href="http://www.autoitscript.com/autoit3/index.shtml">AutoIt</a> :)<p>Ну вот и всё, что я хотел рассказать про снятие скриншотов при выполнении тестов с использованием Selenium и TestNG. Осталось лишь дать ссылку на файл, который содержит исходный код всего этого хозяйства: <a href="http://software-testing.ru/files/library/barancev/selenium_screenshots/SeleniumScreenshots3.zip">SeleniumScreenshots3.zip</a> </span><div id="page-meta" class="t30"><p> <time class="icon-calendar pr20" datetime="2011-01-11" itemprop="datePublished"> 11 января 2011 </time> <span class="icon-archive pr20">&nbsp;<a href="https://webdriver.ru/blog/">БЛОГ</a></span> <br /> <span class="pr20"></span><ul class="pager"><li><a href="https://webdriver.ru/blog/2010-08-18-selenium-waiting-events-2/">&larr; Ожидание событий в Selenium RC, часть 2 -- AJAX</a><li>&nbsp;|&nbsp;<li><a href="https://webdriver.ru/blog/2011-01-11-waiting-for-ajax/">Selenium: ожидание завершения всех AJAX-запросов &rarr;</a></ul></div></article></div><div class="medium-4 columns"><aside><div class="panel radius"><h3>Новые публикации</h3><ul class="side-nav"><li><a href="https://webdriver.ru/news/2019-11-25-seleniumconf-london/">Опубликованы материалы конференции SeleniumConf London 2019</a><li><a href="https://webdriver.ru/news/2019-11-18-selenium-dev/">Запущен новый сайт selenium.dev</a><li><a href="https://webdriver.ru/news/2018-07-10-selenium-314/">Вышел релиз Selenium 3.14</a><li><a href="https://webdriver.ru/news/2018-07-10-selenium-313/">Вышел релиз Selenium 3.13</a><li><a href="https://webdriver.ru/news/2018-06-25-selenium-312/">Вышел релиз Selenium 3.12</a></ul></div><div class="panel radius"><h3>Ближайшие тренинги</h3><ul class="side-nav"><li> <span class="course-title"><a href="http://software-testing.ru/edu/3-online/242-selenium-webdriver"><time class="icon-calendar date"> 18 июня 2021</time><br>Selenium WebDriver: полное руководство</a></span><li> <span class="course-title"><a href="http://software-testing.ru/edu/3-online/226-csharp-for-testers"><time class="icon-calendar date"> 25 июня 2021</time><br>Программирование на C# для тестировщиков</a></span><li> <span class="course-title"><a href="http://software-testing.ru/edu/3-online/19-performance-testing-jmeter"><time class="icon-calendar date"> 2 июля 2021</time><br>Тестирование производительности: JMeter 5</a></span><li> <span class="course-title"><a href="http://software-testing.ru/edu/3-online/185-selenium"><time class="icon-calendar date"> 9 июля 2021</time><br>Selenium IDE 3: стартовый уровень</a></span><li> <span class="course-title"><a href="http://software-testing.ru/edu/3-online/1-java-for-testers"><time class="icon-calendar date"> 9 июля 2021</time><br>Программирование на Java для тестировщиков</a></span><li> <span class="course-title"><a href="http://software-testing.ru/edu/3-online/46-test-design"><time class="icon-calendar date"> 16 июля 2021</time><br>Практикум по тест-дизайну 2.0</a></span><li> <span class="course-title"><a href="http://software-testing.ru/edu/3-online/189-web"><time class="icon-calendar date"> 16 июля 2021</time><br>Тестирование веб-приложений 2.0</a></span><li> <span class="course-title"><a href="http://software-testing.ru/edu/3-online/234-functional-test-automation"><time class="icon-calendar date"> 23 июля 2021</time><br>Автоматизация функционального тестирования</a></span><li> <span class="course-title"><a href="http://software-testing.ru/edu/3-online/233-python"><time class="icon-calendar date"> 23 июля 2021</time><br>Программирование на Python для тестировщиков</a></span></ul></div></aside></div></div><footer id="footer-content" class="bg-grau"><div id="footer"><div class="row"><div class="medium-6 large-5 columns"><h5 class="shadow-black">О нас</h5><ul class="no-bullet shadow-black"><li><a href="https://webdriver.ru/info/">Пишем про Selenium на русском языке</a></ul></div><div class="small-6 medium-3 large-3 large-offset-1 columns"><h5 class="shadow-black">RSS/Atom</h5><ul class="no-bullet shadow-black"><li > <a href="" title=""></a><li > <a href="/feed.xml" title="Subscribe to RSS Feed">RSS</a><li > <a href="/atom.xml" title="Subscribe to Atom Feed">Atom</a></ul></div><div class="small-6 medium-3 large-3 columns"><h5 class="shadow-black">Благодарности</h5><ul class="no-bullet shadow-black"><li > <a href="" title=""></a><li class="services-newsletter" > <a href="https://jekyllrb.com/" target="_blank" title="Built with Jekyll">Built with Jekyll</a><li class="services-newsletter" > <a href="https://github.com/Phlow/feeling-responsive" target="_blank" title="Design by Phlow">Design by Phlow</a><li class="services-newsletter" > <a href="http://foundation.zurb.com/" target="_blank" title="Built on Foundation">Built on Foundation</a></ul></div></div></div><div id="subfooter"><nav class="row"><section id="subfooter-left" class="b30 small-12 medium-6 columns credits"></section><section id="subfooter-right" class="small-12 medium-6 columns social-icons"><ul class="inline-list"></ul></section></nav></div></footer><script src="https://webdriver.ru/assets/js/javascript.min.js"></script></div>
